<main class="w-full">
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8 m-4">
    <h2 class="text-2xl font-bold text-gray-900 mb-8">Process Customer Transaction</h2>
    <div class="mb-8">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Select Transaction Type</h3>
      <div class="grid grid-cols-6 gap-4">
        <div *ngFor="let type of operationTypes" 
             [class]="['transaction-type-card border-2 rounded-lg p-6 cursor-pointer transition-colors', 
                       isSelectedType(type) ? 'border-primary bg-primary/5' : 'border-gray-200']"
             (click)="selectTransactionType(type)">
          <div class="w-12 h-12 flex items-center justify-center bg-primary/10 rounded-lg mb-4 mx-auto">
            <i [class]="getIconForType(type.optLabe)"></i>
          </div>
          <h4 class="text-center font-semibold text-gray-900">{{ type.optLabe }}</h4>
          <p class="text-center text-sm text-gray-600 mt-2">
            {{ getDescriptionForType(type.optLabe) }}
          </p>
        </div>
      </div>
    </div>

    <!-- QR Code Options Section -->
    <div *ngIf="selectedType === 'OPT-006'" class="mb-6 p-4 bg-gray-50 rounded-lg">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">QR Code Options</h3>
      
      <div class="grid grid-cols-2 gap-4">
        <button 
          type="button" 
          (click)="generateQRCode()" 
          [disabled]="isGeneratingQR || !recipientAccount || !amount"
          class="px-4 py-2 bg-blue-600 text-white rounded-button font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
          <span *ngIf="!isGeneratingQR">Generate QR Code</span>
          <span *ngIf="isGeneratingQR">Generating...</span>
        </button>
        
        <div class="relative">
          <input 
            type="file" 
            (change)="onFileSelected($event)" 
            accept="image/*" 
            class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
          <div class="px-4 py-2 border border-gray-300 rounded-button text-center bg-white cursor-pointer">
            Scan QR Code
          </div>
        </div>
      </div>
      
      <div *ngIf="qrCodeImage" class="mt-4 p-4 bg-white rounded-lg border border-gray-200">
        <h4 class="text-md font-medium text-gray-900 mb-2">Generated QR Code</h4>
        <img [src]="qrCodeImage" alt="QR Code" class="mx-auto w-48 h-48">
        <p class="text-sm text-gray-600 mt-2 text-center">Scan this code to receive payment</p>
      </div>
    </div>

    <form (ngSubmit)="processTransaction()" class="space-y-6">
      <div class="grid grid-cols-2 gap-6">
        <div>
          <label class="block text-sm font-medium text-gray-900 mb-2">Customer Account Number</label>
          <div class="relative">
            <input type="text" [(ngModel)]="accountNumber" (input)="onAccountNumberInput()" name="accountNumber" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm" placeholder="Enter account number">
            <div class="absolute right-3 top-1/2 transform -translate-y-1/2">
              <div class="w-5 h-5 flex items-center justify-center" [class.hidden]="!accountValid">
                <i class="ri-check-line text-green-500"></i>
              </div>
              <div class="w-5 h-5 flex items-center justify-center" [class.hidden]="!accountLoading">
                <i class="ri-loader-4-line text-gray-400 animate-spin"></i>
              </div>
            </div>
          </div>
          <div class="text-sm text-red-600 mt-1" [class.hidden]="accountNumber.length === 0 || accountValid || accountLoading">Please enter a valid account number</div>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-900 mb-2">Sender's Wallet ID</label>
          <div class="relative">
            <input type="text" [(ngModel)]="senderWallet" (input)="onWalletInput()" name="senderWallet" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm" placeholder="Enter sender's wallet ID">
            <div class="absolute right-3 top-1/2 transform -translate-y-1/2">
              <div class="w-5 h-5 flex items-center justify-center" [class.hidden]="!walletValid">
                <i class="ri-check-line text-green-500"></i>
              </div>
            </div>
          </div>
          <div class="text-sm text-red-600 mt-1" [class.hidden]="senderWallet.length === 0 || walletValid">Please enter a valid wallet ID</div>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-900 mb-2">Customer Name</label>
          <input type="text" [(ngModel)]="customerName" name="customerName" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-sm" placeholder="Auto-populated" readonly>
        </div>
      </div>
      <div class="grid grid-cols-2 gap-6">
        <div>
          <label class="block text-sm font-medium text-gray-900 mb-2">Amount</label>
          <div class="relative">
            <div class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm">$</div>
            <input type="text" [(ngModel)]="amount" (input)="onAmountInput()" name="amount" class="w-full pl-8 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm" placeholder="0.00">
          </div>
          <div class="text-sm text-red-600 mt-1" [class.hidden]="amount.length === 0 || !isNaN(amount) && parseFloat(amount) > 0">Please enter a valid amount</div>
          <div class="text-sm text-yellow-600 mt-1" 
               [class.hidden]="!(selectedType === 'OPT-002' && accountNumber && customerData[accountNumber] && parseFloat(amount) > customerData[accountNumber].balance)">
            Insufficient balance for this withdrawal
          </div>
        </div>
        <div id="recipient-field" [class.hidden]="selectedType !== 'OPT-003' && selectedType !== 'OPT-004'">
          <label class="block text-sm font-medium text-gray-900 mb-2" id="recipient-label">
            {{ selectedType === 'OPT-003' ? 'Recipient Account Number' : 'Recipient Wallet ID' }}
          </label>
          <input type="text" [(ngModel)]="recipientAccount" name="recipientAccount" (input)="validateForm()" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm" 
                 [placeholder]="selectedType === 'OPT-003' ? 'Enter recipient account number' : 'Enter recipient wallet ID'">
          <div class="text-sm text-red-600 mt-1" [class.hidden]="recipientAccount.length > 0">Please enter valid recipient details</div>
        </div>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-900 mb-2">Purpose / Notes</label>
        <textarea [(ngModel)]="purpose" name="purpose" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm" placeholder="Enter transaction purpose or additional notes"></textarea>
      </div>
      <div class="flex justify-end space-x-4 pt-6">
        <button type="button" (click)="clearForm()" class="px-6 py-3 border border-gray-900 text-gray-900 rounded-button font-medium hover:bg-gray-50 transition-colors whitespace-nowrap">
          Clear Form
        </button>
        <button type="submit" id="process-transaction" class="px-6 py-3 bg-primary text-white rounded-button font-medium hover:bg-red-700 transition-colors whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed" disabled>
          Process Transaction
        </button>
      </div>
    </form>
  </div>
</main>

<!-- Confirmation Modal -->
<div id="confirmation-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
    <div class="bg-primary text-white px-6 py-4 rounded-t-lg">
      <h3 class="text-lg font-semibold">Confirm Transaction</h3>
    </div>
    <div class="p-6">
      <div class="mb-6">
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
          <div class="flex items-start">
            <div class="w-5 h-5 flex items-center justify-center mr-3 mt-0.5">
              <i class="ri-alert-line text-yellow-600"></i>
            </div>
            <div class="text-sm text-yellow-800">
              <strong>Warning:</strong> This transaction cannot be undone. Please verify all details before confirming.
            </div>
          </div>
        </div>
        <div class="space-y-3 text-sm">
          <div class="flex justify-between">
            <span class="text-gray-600">Transaction Type:</span>
            <span class="font-medium" id="confirm-type"></span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Customer:</span>
            <span class="font-medium" id="confirm-customer"></span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Account:</span>
            <span class="font-medium" id="confirm-account"></span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Wallet ID:</span>
            <span class="font-medium" id="confirm-wallet"></span>
          </div>
          <div class="flex justify-between">
            <span class="text-gray-600">Amount:</span>
            <span class="font-medium text-primary" id="confirm-amount"></span>
          </div>
          <div class="flex justify-between" id="confirm-recipient-row" style="display: none;">
            <span class="text-gray-600">Recipient:</span>
            <span class="font-medium" id="confirm-recipient"></span>
          </div>
        </div>
      </div>
      <div class="flex space-x-3">
        <button type="button" (click)="hideConfirmationModal()" class="flex-1 px-4 py-2 border border-gray-900 text-gray-900 rounded-button font-medium hover:bg-gray-50 transition-colors whitespace-nowrap">
          Cancel
        </button>
        <button type="button" (click)="confirmTransaction()" id="confirm-transaction" class="flex-1 px-4 py-2 bg-primary text-white rounded-button font-medium hover:bg-red-700 transition-colors whitespace-nowrap">
          Confirm Transaction
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Toast Notification -->
<div id="toast" class="fixed top-4 right-4 z-50 hidden">
  <div class="bg-white border border-gray-200 rounded-lg shadow-lg p-4 max-w-sm">
    <div class="flex items-start">
      <div class="w-5 h-5 flex items-center justify-center mr-3 mt-0.5">
        <i id="toast-icon" class="ri-check-line text-green-500"></i>
      </div>
      <div>
        <div class="font-medium text-gray-900" id="toast-title">Success</div>
        <div class="text-sm text-gray-600 mt-1" id="toast-message">Transaction processed successfully</div>
        <div class="text-xs text-gray-500 mt-2" id="toast-reference"></div>
      </div>
    </div>
  </div>
</div>